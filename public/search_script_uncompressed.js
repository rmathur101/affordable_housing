function logData(e,t){$.ajax({type:"POST",url:"/log_data_beta",data:{data:{IPDATA:IPDATA,anyHouseType:$("[data-home-type='any']").prop("checked"),singleFamily:$("[data-home-type='single-family']").prop("checked"),multiFamily:$("[data-home-type='multi-family']").prop("checked"),duplex:$("[data-home-type='duplex']").prop("checked"),own:$("[data-ownership='own']").prop("checked"),rent:$("[data-ownership='rent']").prop("checked"),householdIncome:$("#income-slider").val(),address:$("#autocomplete").val(),radius:$("#search-radius").val(),displayRed:$("#display-matches").prop("checked"),extraData:t,DESC:e}},success:function(e){},error:function(){}})}function initAutocomplete(){var e=document.getElementById("autocomplete"),t=new google.maps.LatLngBounds(new google.maps.LatLng(30.16023,-98.052292),new google.maps.LatLng(30.16023,-98.052292)),o=new google.maps.places.SearchBox(e,{bounds:t});geocoder=new google.maps.Geocoder,o.addListener("places_changed",function(){myLatLong=[];var e=o.getPlaces()[0];e.place_id&&geocoder.geocode({placeId:e.place_id},function(e,t){myLatLong=getLatLongFromResults(e)})})}function getLatLongFromResults(e){if(e&&e[0]&&e[0].geometry&&e[0].geometry.location){var t=e[0].geometry.location.lat(),o=e[0].geometry.location.lng();return t&&o?[t,o]:[]}}function convertMilesToMeters(e){return 1609.34*e}function calculateDistanceBetween(e,t){var o=google.maps.geometry.spherical,a=new google.maps.LatLng({lat:e[0],lng:e[1]}),r=new google.maps.LatLng({lat:t[0],lng:t[1]});return o.computeDistanceBetween(a,r)}function getAddressRadius(){return $("#search-radius").val()}function doSearch(e,t,o){return function(){atLeastOneSearch||(atLeastOneSearch=!0,$(".my-close-button").click()),removeMarkers(t,o);var a=getSearchOptions();if(o=renderMarkers(e,t,null,a),myMarker&&t.removeLayer(myMarker),circle&&t.removeLayer(circle),!isAutoCompleteEmpty()&&myLatLong.length>0){myMarker=L.marker(myLatLong,{icon:assignMarker("green")}),o.addLayer(myMarker),t.addLayer(o);var r=new L.LatLng(myLatLong[0],myLatLong[1]),n=convertMilesToMeters(getAddressRadius());circle=new L.Circle(r,n,{color:"red",fillColor:"#5cb85c",fillOpacity:.5,stroke:!1}),t.addLayer(circle)}logData("SEARCH CLICKED")}}function isDisplayMissesChecked(){return $("#display-matches").prop("checked")}function getSearchOptions(){return{familySize:0,householdIncome:$("#income-slider").val()}}function getSliderOptions(){return{formatter:function(e){return"$"+function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}(e)}}}function initMap(){return mymap=L.map("mapid",{zoomControl:!1}).setView([30.290768,-97.674724],12.5),mymap}function showSearch(e){$("#search").toggle(e)}function showResearch(e){$("#research").toggle(e)}function readyToSearch(e){e?$("#search").addClass("btn-success"):$("#search").removeClass("btn-success")}function removeMarkers(e,t){e.removeLayer(t)}function initTitleLayer(){return L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"mapbox.streets",accessToken:"pk.eyJ1Ijoicm1hdGh1cjEwMSIsImEiOiJjajg3a3I0cjIwb2lqMndtdGVtaWx1ZjZrIn0.iEel0XmzyrU4fz78lEQ3GQ"})}function isAutoCompleteEmpty(){return!($("#autocomplete").val().length>0)}function filterByRadius(e){if(isAutoCompleteEmpty()||0==myLatLong.length)return!0;var t=e.Location.match(/\d*\.\d*/g),o=parseFloat(t[0]),a=-parseFloat(t[1]);return calculateDistanceBetween(myLatLong,[o,a])<=convertMilesToMeters(getAddressRadius())}function filterHomeType(e){var t=[];return $(".home-type-group").each(function(){$(this).prop("checked")&&t.push($(this).data("homeType"))}),!!_.contains(t,"any")||(!(!_.contains(t,"single-family")||"Single Family"!=$.trim(e["Unit Type"]))||(!(!_.contains(t,"multi-family")||"Multifamily"!=$.trim(e["Unit Type"]))||!(!_.contains(t,"duplex")||"Duplex"!=$.trim(e["Unit Type"]))))}function filterHomeOwnership(e){var t=[];return $(".ownership").each(function(){$(this).prop("checked")&&t.push($(this).data("ownership"))}),!(!_.contains(t,"own")||"Ownership"!=$.trim(e["Housing Type"]))||!(!_.contains(t,"rent")||"Rental"!=$.trim(e["Housing Type"]))}function filterFunction(e,t,o){var a=[];for(d in e){var r=e[d];r.Location&&r.Location.length>0&&t(r,o)&&(filterIncomeThreshold(r,o)&&filterByRadius(r)&&filterHomeType(r)&&filterHomeOwnership(r)?(r.showAsAvailable=!0,a.push(r)):(r.showAsAvailable=!1,isDisplayMissesChecked()&&a.push(r)))}return a}function renderMarkers(e,t,o,a){var r=new L.FeatureGroup;if(o)n=filterFunction(e,o);else var n=e;n=filterFunction(n,function(e,t){var o=new Date,a=new Date("12/31/2099");return(!_.isUndefined(e["Affordability Expiration Date"])||!_.isNull(e["Affordability Expiration Date"]))&&!!function(e,t,o){return o>=e&&o<=t}(o,a,new Date(e["Affordability Expiration Date"]))},a),currentData=n;for(var i in n){var s=n[i];if(s.Location&&s.Location.length>0){var c=s.Location.match(/\d*\.\d*/g);if(1==s.showAsAvailable)l=L.marker([parseFloat(c[0]),-parseFloat(c[1])],{icon:assignMarker("blue")});else var l=L.marker([parseFloat(c[0]),-parseFloat(c[1])],{icon:assignMarker("red")});l.markerID=i,l.on("click",markerOnClick),r.addLayer(l)}}return t.addLayer(r),r}function filterIncomeThreshold(e,t){o=1e6;if(t){var o=t.householdIncome;t.familySize}if(o){var a=parseFloat(o/83e3*100),r=[];a<80&&r.push(80),a<60&&r.push(60),a<50&&r.push(50),a<40&&r.push(40);var n=0;return _.contains(r,80)||(n+=e["Units <= 80% MFI"]),_.contains(r,60)||(n+=e["Units <= 60% MFI"]),_.contains(r,50)||(n+=e["Units <= 50% MFI"]),_.contains(r,40)||(n+=e["Units <= 40% MFI"]),(n+=e["Units <= 30% MFI"])>0}return!0}function assignMarker(e){return L.AwesomeMarkers.icon({markerColor:e})}function markerOnClick(){this.unbindPopup();var e=this.markerID,t=currentData[e],o="";o+='<img style="width: 100px; display: block; margin: auto;" src="house.png"></img>',o+='<br/> <div class="listing-details" style="width: 265px;">Project Name: '+t["Project Name"]+"<br />Address: "+t.Address+"<br />Type: "+t["Housing Type"]+"<br />Unit: "+t["Unit Type"]+"<br />Bus Stop:"+t["Distance to Bus Stop"]+"</div>",o+='<br/><button class="btn search-btn btn-success" style="border: 2px solid black; display: block; margin: auto; width: 265px;">CONTACT</button>',this.bindPopup(o),this.openPopup(),$(".leaflet-popup-content-wrapper").addClass("listing"),$(".leaflet-popup-close-button").css("color","black"),$(".leaflet-popup-close-button").hover(function(e){$(this).css("color","mouseenter"==e.type?"red":"black")}),logData("MARKER CLICKED",t)}var autocomplete,geocoder,myLatLong=[],myMarker,circle,atLeastOneSearch=!1,IPDATA;$(document).ready(function(){$(".slider-handle").css("background-image","none"),$(".slider-handle").css("background-color","#5cb85c"),$(".slider-handle").css("border","2px solid white"),$(".slider-handle").hover(function(){$(this).css("cursor","pointer")}),$(".tooltip-inner").css("background-color","#5cb85c"),$(".tooltip-inner").css("border-radius","0px"),$(".tooltip-inner").css("font-size","15px"),$(".tooltip-inner").css("border","1px solid white"),$(".tooltip-arrow").css("border-bottom-color","white"),$(".my-close-button").click(function(){$(".filter-options").animate({left:"-500px"},{queue:!0,duration:750}),$(".filter-options-banner").animate({left:"0px"},{queue:!0,duration:750})}),$(".filter-options-banner").click(function(){$(".filter-options-banner").animate({left:"-500px"},{queue:!0,duration:750}),$(".filter-options").animate({left:"0px"},{queue:!0,duration:750})}),$(".filter-options-banner").hover(function(e){$(this).css("background-color","mouseenter"==e.type?"#5cb85c":"#337ab7")}),$(".clear-autocomplete").click(function(){$("#autocomplete").val("")}),showResearch(!1),readyToSearch(!0),$("#income-slider").slider(getSliderOptions());var e=initMap(),t=initTitleLayer();L.control.zoom({position:"bottomright"}).addTo(e),t.addTo(e);var o=JSON.parse(jsonAHIObject),a=null;a=renderMarkers(o,e),$("#search").click(doSearch(o,e,a)),$.ajax({type:"GET",url:"https://freegeoip.net/json/?callback",success:function(e){console.log("something"),IPDATA=e,logData("PAGE VISIT")},error:function(){}})});